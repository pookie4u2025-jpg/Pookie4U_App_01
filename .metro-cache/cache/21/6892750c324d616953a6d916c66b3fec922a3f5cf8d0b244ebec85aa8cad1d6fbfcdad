{"dependencies":[{"name":"./DateFormatter","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":6,"column":0,"index":130},"end":{"line":6,"column":51,"index":181}}],"key":"QwRrrlxeKY6lWtH+RjiTvmDKAEQ=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"getDailyMessageIndex\", {\n    enumerable: true,\n    get: function () {\n      return getDailyMessageIndex;\n    }\n  });\n  Object.defineProperty(exports, \"filterMessagesByRelationshipMode\", {\n    enumerable: true,\n    get: function () {\n      return filterMessagesByRelationshipMode;\n    }\n  });\n  Object.defineProperty(exports, \"getDailyMessage\", {\n    enumerable: true,\n    get: function () {\n      return getDailyMessage;\n    }\n  });\n  Object.defineProperty(exports, \"hasMessageChanged\", {\n    enumerable: true,\n    get: function () {\n      return hasMessageChanged;\n    }\n  });\n  Object.defineProperty(exports, \"getDailyMessageByCategory\", {\n    enumerable: true,\n    get: function () {\n      return getDailyMessageByCategory;\n    }\n  });\n  Object.defineProperty(exports, \"getTimeUntilNextRotation\", {\n    enumerable: true,\n    get: function () {\n      return getTimeUntilNextRotation;\n    }\n  });\n  Object.defineProperty(exports, \"MESSAGE_CATEGORIES\", {\n    enumerable: true,\n    get: function () {\n      return MESSAGE_CATEGORIES;\n    }\n  });\n  Object.defineProperty(exports, \"RELATIONSHIP_MODES\", {\n    enumerable: true,\n    get: function () {\n      return RELATIONSHIP_MODES;\n    }\n  });\n  var _DateFormatter = require(_dependencyMap[0], \"./DateFormatter\");\n  /**\n   * Daily love message rotation utility\n   * Rotates messages based on relationship_mode and current date at local midnight\n   */\n\n  // Generate deterministic index based on user ID and date\n  const getDailyMessageIndex = (userId, messages, date) => {\n    const targetDate = date || new Date();\n    const midnight = (0, _DateFormatter.getLocalMidnight)(targetDate);\n\n    // Create a seed based on user ID and date (YYYY-MM-DD format)\n    const dateStr = midnight.toISOString().split('T')[0]; // YYYY-MM-DD\n    const seedString = `${userId}-${dateStr}`;\n\n    // Simple hash function for deterministic pseudo-random selection\n    let hash = 0;\n    for (let i = 0; i < seedString.length; i++) {\n      const char = seedString.charCodeAt(i);\n      hash = (hash << 5) - hash + char;\n      hash = hash & hash; // Convert to 32-bit integer\n    }\n\n    // Ensure positive index\n    const positiveHash = Math.abs(hash);\n    return positiveHash % messages.length;\n  };\n\n  // Filter messages based on relationship mode\n  const filterMessagesByRelationshipMode = (messages, relationshipMode) => {\n    return messages.filter(message => {\n      // If message doesn't specify a mode, it's universal\n      if (!message.relationship_mode) {\n        return true;\n      }\n\n      // Match the specific relationship mode\n      return message.relationship_mode === relationshipMode;\n    });\n  };\n\n  // Get daily message for a specific user and relationship mode\n  const getDailyMessage = (userId, allMessages, relationshipMode, date) => {\n    // Filter messages for the relationship mode\n    const filteredMessages = filterMessagesByRelationshipMode(allMessages, relationshipMode);\n    if (filteredMessages.length === 0) {\n      return null;\n    }\n\n    // Get deterministic index for the day\n    const index = getDailyMessageIndex(userId, filteredMessages, date);\n    return filteredMessages[index];\n  };\n\n  // Check if message has changed since last retrieval (for notifications)\n  const hasMessageChanged = (userId, messages, relationshipMode, lastCheckedDate) => {\n    const todayMessage = getDailyMessage(userId, messages, relationshipMode);\n    const yesterdayMessage = getDailyMessage(userId, messages, relationshipMode, lastCheckedDate);\n    return todayMessage?.id !== yesterdayMessage?.id;\n  };\n\n  // Get message for a specific category and relationship mode\n  const getDailyMessageByCategory = (userId, allMessages, relationshipMode, category, date) => {\n    // Filter by both relationship mode and category\n    const filteredMessages = allMessages.filter(message => {\n      const modeMatch = !message.relationship_mode || message.relationship_mode === relationshipMode;\n      const categoryMatch = message.category === category;\n      return modeMatch && categoryMatch;\n    });\n    if (filteredMessages.length === 0) {\n      return null;\n    }\n    const index = getDailyMessageIndex(`${userId}-${category}`, filteredMessages, date);\n    return filteredMessages[index];\n  };\n\n  // Utility to get time until next message rotation (midnight)\n  const getTimeUntilNextRotation = () => {\n    const now = new Date();\n    const nextMidnight = new Date(now);\n    nextMidnight.setDate(nextMidnight.getDate() + 1);\n    nextMidnight.setHours(0, 0, 0, 0);\n    return nextMidnight.getTime() - now.getTime();\n  };\n\n  // Categories for different message types\n  const MESSAGE_CATEGORIES = {\n    GOOD_MORNING: 'good_morning',\n    GOOD_NIGHT: 'good_night',\n    LOVE_CONFESSION: 'love_confession',\n    APOLOGY: 'apology',\n    FUNNY_HINGLISH: 'funny_hinglish',\n    ENCOURAGEMENT: 'encouragement',\n    ROMANTIC: 'romantic',\n    APPRECIATION: 'appreciation'\n  };\n\n  // Relationship modes\n  const RELATIONSHIP_MODES = {\n    SAME_HOME: 'SAME_HOME',\n    DAILY_IRL: 'DAILY_IRL',\n    LONG_DISTANCE: 'LONG_DISTANCE'\n  };\n});","lineCount":158,"map":[[7,2,16,0,"Object"],[7,8,16,0],[7,9,16,0,"defineProperty"],[7,23,16,0],[7,24,16,0,"exports"],[7,31,16,0],[8,4,16,0,"enumerable"],[8,14,16,0],[9,4,16,0,"get"],[9,7,16,0],[9,18,16,0,"get"],[9,19,16,0],[10,6,16,0],[10,13,16,0,"getDailyMessageIndex"],[10,33,16,0],[11,4,16,0],[12,2,16,0],[13,2,39,0,"Object"],[13,8,39,0],[13,9,39,0,"defineProperty"],[13,23,39,0],[13,24,39,0,"exports"],[13,31,39,0],[14,4,39,0,"enumerable"],[14,14,39,0],[15,4,39,0,"get"],[15,7,39,0],[15,18,39,0,"get"],[15,19,39,0],[16,6,39,0],[16,13,39,0,"filterMessagesByRelationshipMode"],[16,45,39,0],[17,4,39,0],[18,2,39,0],[19,2,55,0,"Object"],[19,8,55,0],[19,9,55,0,"defineProperty"],[19,23,55,0],[19,24,55,0,"exports"],[19,31,55,0],[20,4,55,0,"enumerable"],[20,14,55,0],[21,4,55,0,"get"],[21,7,55,0],[21,18,55,0,"get"],[21,19,55,0],[22,6,55,0],[22,13,55,0,"getDailyMessage"],[22,28,55,0],[23,4,55,0],[24,2,55,0],[25,2,75,0,"Object"],[25,8,75,0],[25,9,75,0,"defineProperty"],[25,23,75,0],[25,24,75,0,"exports"],[25,31,75,0],[26,4,75,0,"enumerable"],[26,14,75,0],[27,4,75,0,"get"],[27,7,75,0],[27,18,75,0,"get"],[27,19,75,0],[28,6,75,0],[28,13,75,0,"hasMessageChanged"],[28,30,75,0],[29,4,75,0],[30,2,75,0],[31,2,88,0,"Object"],[31,8,88,0],[31,9,88,0,"defineProperty"],[31,23,88,0],[31,24,88,0,"exports"],[31,31,88,0],[32,4,88,0,"enumerable"],[32,14,88,0],[33,4,88,0,"get"],[33,7,88,0],[33,18,88,0,"get"],[33,19,88,0],[34,6,88,0],[34,13,88,0,"getDailyMessageByCategory"],[34,38,88,0],[35,4,88,0],[36,2,88,0],[37,2,111,0,"Object"],[37,8,111,0],[37,9,111,0,"defineProperty"],[37,23,111,0],[37,24,111,0,"exports"],[37,31,111,0],[38,4,111,0,"enumerable"],[38,14,111,0],[39,4,111,0,"get"],[39,7,111,0],[39,18,111,0,"get"],[39,19,111,0],[40,6,111,0],[40,13,111,0,"getTimeUntilNextRotation"],[40,37,111,0],[41,4,111,0],[42,2,111,0],[43,2,121,0,"Object"],[43,8,121,0],[43,9,121,0,"defineProperty"],[43,23,121,0],[43,24,121,0,"exports"],[43,31,121,0],[44,4,121,0,"enumerable"],[44,14,121,0],[45,4,121,0,"get"],[45,7,121,0],[45,18,121,0,"get"],[45,19,121,0],[46,6,121,0],[46,13,121,0,"MESSAGE_CATEGORIES"],[46,31,121,0],[47,4,121,0],[48,2,121,0],[49,2,133,0,"Object"],[49,8,133,0],[49,9,133,0,"defineProperty"],[49,23,133,0],[49,24,133,0,"exports"],[49,31,133,0],[50,4,133,0,"enumerable"],[50,14,133,0],[51,4,133,0,"get"],[51,7,133,0],[51,18,133,0,"get"],[51,19,133,0],[52,6,133,0],[52,13,133,0,"RELATIONSHIP_MODES"],[52,31,133,0],[53,4,133,0],[54,2,133,0],[55,2,6,0],[55,6,6,0,"_DateFormatter"],[55,20,6,0],[55,23,6,0,"require"],[55,30,6,0],[55,31,6,0,"_dependencyMap"],[55,45,6,0],[56,2,1,0],[57,0,2,0],[58,0,3,0],[59,0,4,0],[61,2,15,0],[62,2,16,7],[62,8,16,13,"getDailyMessageIndex"],[62,28,16,33],[62,31,16,36,"getDailyMessageIndex"],[62,32,16,37,"userId"],[62,38,16,51],[62,40,16,53,"messages"],[62,48,16,76],[62,50,16,78,"date"],[62,54,16,89],[62,59,16,102],[63,4,17,2],[63,10,17,8,"targetDate"],[63,20,17,18],[63,23,17,21,"date"],[63,27,17,25],[63,31,17,29],[63,35,17,33,"Date"],[63,39,17,37],[63,40,17,38],[63,41,17,39],[64,4,18,2],[64,10,18,8,"midnight"],[64,18,18,16],[64,21,18,19],[64,25,18,19,"getLocalMidnight"],[64,39,18,35],[64,40,18,35,"getLocalMidnight"],[64,56,18,35],[64,58,18,36,"targetDate"],[64,68,18,46],[64,69,18,47],[66,4,20,2],[67,4,21,2],[67,10,21,8,"dateStr"],[67,17,21,15],[67,20,21,18,"midnight"],[67,28,21,26],[67,29,21,27,"toISOString"],[67,40,21,38],[67,41,21,39],[67,42,21,40],[67,43,21,41,"split"],[67,48,21,46],[67,49,21,47],[67,52,21,50],[67,53,21,51],[67,54,21,52],[67,55,21,53],[67,56,21,54],[67,57,21,55],[67,58,21,56],[68,4,22,2],[68,10,22,8,"seedString"],[68,20,22,18],[68,23,22,21],[68,26,22,24,"userId"],[68,32,22,30],[68,36,22,34,"dateStr"],[68,43,22,41],[68,45,22,43],[70,4,24,2],[71,4,25,2],[71,8,25,6,"hash"],[71,12,25,10],[71,15,25,13],[71,16,25,14],[72,4,26,2],[72,9,26,7],[72,13,26,11,"i"],[72,14,26,12],[72,17,26,15],[72,18,26,16],[72,20,26,18,"i"],[72,21,26,19],[72,24,26,22,"seedString"],[72,34,26,32],[72,35,26,33,"length"],[72,41,26,39],[72,43,26,41,"i"],[72,44,26,42],[72,46,26,44],[72,48,26,46],[73,6,27,4],[73,12,27,10,"char"],[73,16,27,14],[73,19,27,17,"seedString"],[73,29,27,27],[73,30,27,28,"charCodeAt"],[73,40,27,38],[73,41,27,39,"i"],[73,42,27,40],[73,43,27,41],[74,6,28,4,"hash"],[74,10,28,8],[74,13,28,12],[74,14,28,13,"hash"],[74,18,28,17],[74,22,28,21],[74,23,28,22],[74,27,28,26,"hash"],[74,31,28,30],[74,34,28,34,"char"],[74,38,28,38],[75,6,29,4,"hash"],[75,10,29,8],[75,13,29,11,"hash"],[75,17,29,15],[75,20,29,18,"hash"],[75,24,29,22],[75,25,29,23],[75,26,29,24],[76,4,30,2],[78,4,32,2],[79,4,33,2],[79,10,33,8,"positiveHash"],[79,22,33,20],[79,25,33,23,"Math"],[79,29,33,27],[79,30,33,28,"abs"],[79,33,33,31],[79,34,33,32,"hash"],[79,38,33,36],[79,39,33,37],[80,4,35,2],[80,11,35,9,"positiveHash"],[80,23,35,21],[80,26,35,24,"messages"],[80,34,35,32],[80,35,35,33,"length"],[80,41,35,39],[81,2,36,0],[81,3,36,1],[83,2,38,0],[84,2,39,7],[84,8,39,13,"filterMessagesByRelationshipMode"],[84,40,39,45],[84,43,39,48,"filterMessagesByRelationshipMode"],[84,44,40,2,"messages"],[84,52,40,25],[84,54,41,2,"relationshipMode"],[84,70,41,26],[84,75,42,20],[85,4,43,2],[85,11,43,9,"messages"],[85,19,43,17],[85,20,43,18,"filter"],[85,26,43,24],[85,27,43,25,"message"],[85,34,43,32],[85,38,43,36],[86,6,44,4],[87,6,45,4],[87,10,45,8],[87,11,45,9,"message"],[87,18,45,16],[87,19,45,17,"relationship_mode"],[87,36,45,34],[87,38,45,36],[88,8,46,6],[88,15,46,13],[88,19,46,17],[89,6,47,4],[91,6,49,4],[92,6,50,4],[92,13,50,11,"message"],[92,20,50,18],[92,21,50,19,"relationship_mode"],[92,38,50,36],[92,43,50,41,"relationshipMode"],[92,59,50,57],[93,4,51,2],[93,5,51,3],[93,6,51,4],[94,2,52,0],[94,3,52,1],[96,2,54,0],[97,2,55,7],[97,8,55,13,"getDailyMessage"],[97,23,55,28],[97,26,55,31,"getDailyMessage"],[97,27,56,2,"userId"],[97,33,56,16],[97,35,57,2,"allMessages"],[97,46,57,28],[97,48,58,2,"relationshipMode"],[97,64,58,26],[97,66,59,2,"date"],[97,70,59,13],[97,75,60,25],[98,4,61,2],[99,4,62,2],[99,10,62,8,"filteredMessages"],[99,26,62,24],[99,29,62,27,"filterMessagesByRelationshipMode"],[99,61,62,59],[99,62,62,60,"allMessages"],[99,73,62,71],[99,75,62,73,"relationshipMode"],[99,91,62,89],[99,92,62,90],[100,4,64,2],[100,8,64,6,"filteredMessages"],[100,24,64,22],[100,25,64,23,"length"],[100,31,64,29],[100,36,64,34],[100,37,64,35],[100,39,64,37],[101,6,65,4],[101,13,65,11],[101,17,65,15],[102,4,66,2],[104,4,68,2],[105,4,69,2],[105,10,69,8,"index"],[105,15,69,13],[105,18,69,16,"getDailyMessageIndex"],[105,38,69,36],[105,39,69,37,"userId"],[105,45,69,43],[105,47,69,45,"filteredMessages"],[105,63,69,61],[105,65,69,63,"date"],[105,69,69,67],[105,70,69,68],[106,4,71,2],[106,11,71,9,"filteredMessages"],[106,27,71,25],[106,28,71,26,"index"],[106,33,71,31],[106,34,71,32],[107,2,72,0],[107,3,72,1],[109,2,74,0],[110,2,75,7],[110,8,75,13,"hasMessageChanged"],[110,25,75,30],[110,28,75,33,"hasMessageChanged"],[110,29,76,2,"userId"],[110,35,76,16],[110,37,77,2,"messages"],[110,45,77,25],[110,47,78,2,"relationshipMode"],[110,63,78,26],[110,65,79,2,"lastCheckedDate"],[110,80,79,23],[110,85,80,14],[111,4,81,2],[111,10,81,8,"todayMessage"],[111,22,81,20],[111,25,81,23,"getDailyMessage"],[111,40,81,38],[111,41,81,39,"userId"],[111,47,81,45],[111,49,81,47,"messages"],[111,57,81,55],[111,59,81,57,"relationshipMode"],[111,75,81,73],[111,76,81,74],[112,4,82,2],[112,10,82,8,"yesterdayMessage"],[112,26,82,24],[112,29,82,27,"getDailyMessage"],[112,44,82,42],[112,45,82,43,"userId"],[112,51,82,49],[112,53,82,51,"messages"],[112,61,82,59],[112,63,82,61,"relationshipMode"],[112,79,82,77],[112,81,82,79,"lastCheckedDate"],[112,96,82,94],[112,97,82,95],[113,4,84,2],[113,11,84,9,"todayMessage"],[113,23,84,21],[113,25,84,23,"id"],[113,27,84,25],[113,32,84,30,"yesterdayMessage"],[113,48,84,46],[113,50,84,48,"id"],[113,52,84,50],[114,2,85,0],[114,3,85,1],[116,2,87,0],[117,2,88,7],[117,8,88,13,"getDailyMessageByCategory"],[117,33,88,38],[117,36,88,41,"getDailyMessageByCategory"],[117,37,89,2,"userId"],[117,43,89,16],[117,45,90,2,"allMessages"],[117,56,90,28],[117,58,91,2,"relationshipMode"],[117,74,91,26],[117,76,92,2,"category"],[117,84,92,18],[117,86,93,2,"date"],[117,90,93,13],[117,95,94,25],[118,4,95,2],[119,4,96,2],[119,10,96,8,"filteredMessages"],[119,26,96,24],[119,29,96,27,"allMessages"],[119,40,96,38],[119,41,96,39,"filter"],[119,47,96,45],[119,48,96,46,"message"],[119,55,96,53],[119,59,96,57],[120,6,97,4],[120,12,97,10,"modeMatch"],[120,21,97,19],[120,24,97,22],[120,25,97,23,"message"],[120,32,97,30],[120,33,97,31,"relationship_mode"],[120,50,97,48],[120,54,97,52,"message"],[120,61,97,59],[120,62,97,60,"relationship_mode"],[120,79,97,77],[120,84,97,82,"relationshipMode"],[120,100,97,98],[121,6,98,4],[121,12,98,10,"categoryMatch"],[121,25,98,23],[121,28,98,26,"message"],[121,35,98,33],[121,36,98,34,"category"],[121,44,98,42],[121,49,98,47,"category"],[121,57,98,55],[122,6,99,4],[122,13,99,11,"modeMatch"],[122,22,99,20],[122,26,99,24,"categoryMatch"],[122,39,99,37],[123,4,100,2],[123,5,100,3],[123,6,100,4],[124,4,102,2],[124,8,102,6,"filteredMessages"],[124,24,102,22],[124,25,102,23,"length"],[124,31,102,29],[124,36,102,34],[124,37,102,35],[124,39,102,37],[125,6,103,4],[125,13,103,11],[125,17,103,15],[126,4,104,2],[127,4,106,2],[127,10,106,8,"index"],[127,15,106,13],[127,18,106,16,"getDailyMessageIndex"],[127,38,106,36],[127,39,106,37],[127,42,106,40,"userId"],[127,48,106,46],[127,52,106,50,"category"],[127,60,106,58],[127,62,106,60],[127,64,106,62,"filteredMessages"],[127,80,106,78],[127,82,106,80,"date"],[127,86,106,84],[127,87,106,85],[128,4,107,2],[128,11,107,9,"filteredMessages"],[128,27,107,25],[128,28,107,26,"index"],[128,33,107,31],[128,34,107,32],[129,2,108,0],[129,3,108,1],[131,2,110,0],[132,2,111,7],[132,8,111,13,"getTimeUntilNextRotation"],[132,32,111,37],[132,35,111,40,"getTimeUntilNextRotation"],[132,36,111,40],[132,41,111,54],[133,4,112,2],[133,10,112,8,"now"],[133,13,112,11],[133,16,112,14],[133,20,112,18,"Date"],[133,24,112,22],[133,25,112,23],[133,26,112,24],[134,4,113,2],[134,10,113,8,"nextMidnight"],[134,22,113,20],[134,25,113,23],[134,29,113,27,"Date"],[134,33,113,31],[134,34,113,32,"now"],[134,37,113,35],[134,38,113,36],[135,4,114,2,"nextMidnight"],[135,16,114,14],[135,17,114,15,"setDate"],[135,24,114,22],[135,25,114,23,"nextMidnight"],[135,37,114,35],[135,38,114,36,"getDate"],[135,45,114,43],[135,46,114,44],[135,47,114,45],[135,50,114,48],[135,51,114,49],[135,52,114,50],[136,4,115,2,"nextMidnight"],[136,16,115,14],[136,17,115,15,"setHours"],[136,25,115,23],[136,26,115,24],[136,27,115,25],[136,29,115,27],[136,30,115,28],[136,32,115,30],[136,33,115,31],[136,35,115,33],[136,36,115,34],[136,37,115,35],[137,4,117,2],[137,11,117,9,"nextMidnight"],[137,23,117,21],[137,24,117,22,"getTime"],[137,31,117,29],[137,32,117,30],[137,33,117,31],[137,36,117,34,"now"],[137,39,117,37],[137,40,117,38,"getTime"],[137,47,117,45],[137,48,117,46],[137,49,117,47],[138,2,118,0],[138,3,118,1],[140,2,120,0],[141,2,121,7],[141,8,121,13,"MESSAGE_CATEGORIES"],[141,26,121,31],[141,29,121,34],[142,4,122,2,"GOOD_MORNING"],[142,16,122,14],[142,18,122,16],[142,32,122,30],[143,4,123,2,"GOOD_NIGHT"],[143,14,123,12],[143,16,123,14],[143,28,123,26],[144,4,124,2,"LOVE_CONFESSION"],[144,19,124,17],[144,21,124,19],[144,38,124,36],[145,4,125,2,"APOLOGY"],[145,11,125,9],[145,13,125,11],[145,22,125,20],[146,4,126,2,"FUNNY_HINGLISH"],[146,18,126,16],[146,20,126,18],[146,36,126,34],[147,4,127,2,"ENCOURAGEMENT"],[147,17,127,15],[147,19,127,17],[147,34,127,32],[148,4,128,2,"ROMANTIC"],[148,12,128,10],[148,14,128,12],[148,24,128,22],[149,4,129,2,"APPRECIATION"],[149,16,129,14],[149,18,129,16],[150,2,130,0],[150,3,130,10],[152,2,132,0],[153,2,133,7],[153,8,133,13,"RELATIONSHIP_MODES"],[153,26,133,31],[153,29,133,34],[154,4,134,2,"SAME_HOME"],[154,13,134,11],[154,15,134,13],[154,26,134,24],[155,4,135,2,"DAILY_IRL"],[155,13,135,11],[155,15,135,13],[155,26,135,24],[156,4,136,2,"LONG_DISTANCE"],[156,17,136,15],[156,19,136,17],[157,2,137,0],[157,3,137,10],[158,0,137,11],[158,3]],"functionMap":{"names":["<global>","getDailyMessageIndex","filterMessagesByRelationshipMode","messages.filter$argument_0","getDailyMessage","hasMessageChanged","getDailyMessageByCategory","allMessages.filter$argument_0","getTimeUntilNextRotation"],"mappings":"AAA;oCCe;CDoB;gDEG;yBCI;GDQ;CFC;+BIG;CJiB;iCKG;CLU;yCMG;8CCQ;GDI;CNQ;wCQG;CRO"},"hasCjsExports":false},"type":"js/module"}]}